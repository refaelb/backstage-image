"use strict";(()=>{(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2719],{12719:(Ze,N,a)=>{a.r(N),a.d(N,{Router:()=>Be});var e=a(2784),w=a(39857),P=a(73557),I=a(60885),z=a(12053),v=a(33761),f=a(94063),O=a(49558),C=a(30705),R=a(57032),T=a(73495),A=a(31011),j=a(77277),F=a(61837),k=a(41156),q=a(88188),ee=a(75650),te=a(56563),L=a(34520),ae=a(77120),ne=a(42123),U=a(79692),$=a(42494),G=a(56939),V=a(73698),X=a(12231),Y=a(94339),H=a(32552),J=a(24579),le=a(67358),Q=a(87685),oe=a(2552),Z=a(10921),re=a(48760),se=a(11280),ie=a(64279),ce=a(12524),be=a.n(ce),Ne=a(26228),me=a(75951),we=a.n(me),Ee=a(19126),ze=a.n(Ee),de=a(82394),je=a.n(de),ue=a(31734),$e=a.n(ue),Ge=a(29641),_e=a(82108),Ve=a.n(_e);const pe=t=>{const{title:n,to:l}=t,{allowed:i}=(0,te.gI)({permission:ee.x7}),r=(0,k.Z)(m=>m.breakpoints.down("xs"));return!l||!i?null:r?e.createElement(F.Z,{component:w.rU,color:"primary",title:n,size:"small",to:l},e.createElement(q.Z,null)):e.createElement(j.Z,{component:w.rU,variant:"contained",color:"primary",to:l},n)},fe={title:"Templates",filter:()=>!0},ve=t=>[...t,{title:"Other Templates",filter:n=>![...t].some(({filter:l})=>l(n))}],ge=t=>{var n,l,i;const r=(0,C.tg)(f.u),{TemplateCardComponent:m,groups:s=[],templateFilter:p,headerOptions:_}=t,c=(0,P.s0)(),u=(0,C.tg)(f.p),D=(0,C.tg)(f.q),E=(0,C.tg)(f.t),g=(0,C.tg)(f.v),M=(0,C.tg)(f.o),h=(0,C.qD)(),o=s.length?ve(s):[fe],d={onEditorClicked:((n=t==null?void 0:t.contextMenu)==null?void 0:n.editor)!==!1?()=>c(u()):void 0,onActionsClicked:((l=t==null?void 0:t.contextMenu)==null?void 0:l.actions)!==!1?()=>c(D()):void 0,onTasksClicked:((i=t==null?void 0:t.contextMenu)==null?void 0:i.tasks)!==!1?()=>c(E()):void 0},y=(0,e.useCallback)(B=>{var K,S;const{kind:Ke,namespace:Se,name:Fe}=(0,L.of)((0,L.eE)(B));return(K=B.metadata.annotations)!=null&&K["backstage.io/techdocs-ref"]&&g?[{icon:(S=h.getSystemIcon("docs"))!=null?S:O.zG,text:"View TechDocs",url:g({kind:Ke,namespace:Se,name:Fe})}]:[]},[h,g]),x=(0,e.useCallback)(B=>{const{namespace:K,name:S}=(0,L.of)((0,L.eE)(B));c(M({namespace:K,templateName:S}))},[c,M]);return e.createElement(T.UO,null,e.createElement(O.T3,{themeId:"home"},e.createElement(O.h4,{pageTitleOverride:"Create a new component",title:"Create a new component",subtitle:"Create new software components using standard templates in your organization",..._},e.createElement(A.zP,{...d})),e.createElement(O.VY,null,e.createElement(O.yW,{title:"Available Templates"},e.createElement(pe,{title:"Register Existing Component",to:r&&r()}),e.createElement(O.qt,null,"Create new software components using standard templates. Different templates create different kinds of components (services, websites, documentation, ...).")),e.createElement(T._i,null,e.createElement(T._i.Filters,null,e.createElement(T.nN,null),e.createElement(T.tW,{initialFilter:"template",hidden:!0}),e.createElement(T.EW,{initialFilter:"all",availableFilters:["all","starred"]}),e.createElement(A._G,null),e.createElement(T.xE,null)),e.createElement(T._i.Content,null,e.createElement(A.ow,{groups:o,templateFilter:p,TemplateCardComponent:m,onTemplateSelected:x,additionalLinksForEntity:y}))))))},Pe=t=>{const n=(0,C.tg)(f.r),l=(0,C.tg)(f.w),{secrets:i}=(0,I.u)(),r=(0,R.u)(I.s),m=(0,P.s0)(),{templateName:s,namespace:p}=(0,C.Oi)(f.o),_=(0,L.eE)({kind:"Template",namespace:p,name:s}),c=async D=>{const{taskId:E}=await r.scaffold({templateRef:_,values:D,secrets:i});m(l({taskId:E}))},u=()=>e.createElement(P.Fg,{to:n()});return e.createElement(C.fC,{attributes:{entityRef:_}},e.createElement(O.T3,{themeId:"website"},e.createElement(O.h4,{pageTitleOverride:"Create a new component",title:"Create a new component",subtitle:"Create new software components using standard templates in your organization",...t.headerOptions}),e.createElement(A.h4,{namespace:p,templateName:s,onCreate:c,components:t.components,onError:u,extensions:t.customFieldExtensions,formProps:t.formProps,layouts:t.layouts})))};var Oe=Object.defineProperty,De=(t,n,l)=>n in t?Oe(t,n,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[n]=l,Ce=(t,n,l)=>(De(t,typeof n!="symbol"?n+"":n,l),l);const Me=(0,U.Z)({containerWrapper:{position:"relative",width:"100%",height:"100%"},container:{position:"absolute",top:0,bottom:0,left:0,right:0,overflow:"auto"}});class Te extends e.Component{constructor(){super(...arguments),Ce(this,"state",{shouldRender:!0})}componentDidUpdate(n){n.invalidator!==this.props.invalidator&&this.setState({shouldRender:!0})}componentDidCatch(n){this.props.setErrorText(n.message),this.setState({shouldRender:!1})}render(){return this.state.shouldRender?this.props.children:null}}function b(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function W(t){const{content:n,contentIsSpec:l,onDryRun:i,setErrorText:r,fieldExtensions:m=[],layouts:s=[]}=t,p=Me(),_=(0,R.b)(),[c,u]=(0,e.useState)(),D=(0,e.useMemo)(()=>Object.fromEntries(m.map(({name:E,component:g})=>[E,g])),[m]);return(0,re.Z)(()=>{try{if(!n){u(void 0);return}const E=Z.ZP.parseAllDocuments(n).filter(o=>o).map(o=>o.toJSON())[0];if(!b(E)){u(void 0);return}let g=E;if(!l){if(!(String(E.kind).toLocaleLowerCase("en-US")==="template")){u(void 0);return}g=b(E.spec)?E.spec:{}}const{parameters:M}=g;if(!Array.isArray(M)){r("Template parameters must be an array"),u(void 0);return}const h=Object.fromEntries(m.map(({name:o,validation:d})=>[o,d]));r(),u(M.flatMap(o=>b(o)?[{title:String(o.title),schema:o,validate:(0,A.br)(o,h,{apiHolder:_})}]:[]))}catch(E){r(E.message)}},250,[l,n,_]),c?e.createElement("div",{className:p.containerWrapper},e.createElement("div",{className:p.container},e.createElement(Te,{invalidator:c,setErrorText:r},e.createElement(A.vF,{manifest:{steps:c,title:"Template Editor"},extensions:m,components:D,onCreate:async E=>{await(i==null?void 0:i(E))},layouts:s})))):null}function he(t){const{setErrorText:n,fieldExtensions:l=[],layouts:i}=t,r=(0,v.u)(),m=(0,v.a)(),{selectedFile:s}=m,p=async c=>{if(s)try{await r.execute({templateContent:s.content,values:c,files:m.files}),n()}catch(u){throw n(String(u.cause||u)),u}},_=s&&s.path.match(/\.ya?ml$/)?s.content:void 0;return e.createElement(W,{onDryRun:p,fieldExtensions:l,setErrorText:n,content:_,layouts:i})}W.DirectoryEditorDryRun=he;const Ae=(0,U.Z)(t=>({root:{gridArea:"pageContent",display:"grid",gridTemplateAreas:`
      "controls controls"
      "fieldForm preview"
    `,gridTemplateRows:"auto 1fr",gridTemplateColumns:"1fr 1fr"},controls:{gridArea:"controls",display:"flex",flexFlow:"row nowrap",alignItems:"center",margin:t.spacing(1)},fieldForm:{gridArea:"fieldForm"},preview:{gridArea:"preview"}})),ye=({customFieldExtensions:t=[],onClose:n})=>{var l,i;const r=Ae(),m=t.filter(o=>!!o.schema),[s,p]=(0,e.useState)(m[0]),[_,c]=(0,e.useState)({}),[u,D]=(0,e.useState)(Date.now()),E=(0,e.useMemo)(()=>{var o,d;return Z.ZP.stringify({parameters:[{title:`${s.name} Example`,properties:{[s.name]:{type:(d=(o=s.schema)==null?void 0:o.returnValue)==null?void 0:d.type,"ui:field":s.name,"ui:options":_}}}]})},[_,s]),g=(0,e.useMemo)(()=>Object.fromEntries(t.map(({name:o,component:d})=>[o,d])),[t]),M=(0,e.useCallback)(o=>{p(o),c({})},[c,p]),h=(0,e.useCallback)(o=>{c(o),D(Date.now())},[c,D]);return e.createElement("main",{className:r.root},e.createElement("div",{className:r.controls},e.createElement($.Z,{variant:"outlined",size:"small",fullWidth:!0},e.createElement(G.Z,{id:"select-field-label"},"Choose Custom Field Extension"),e.createElement(V.Z,{value:s,label:"Choose Custom Field Extension",labelId:"select-field-label",onChange:o=>M(o.target.value)},m.map((o,d)=>e.createElement(X.Z,{key:d,value:o},o.name)))),e.createElement(F.Z,{size:"medium",onClick:n,"aria-label":"Close"},e.createElement(Q.Z,null))),e.createElement("div",{className:r.fieldForm},e.createElement(Y.Z,null,e.createElement(H.Z,{title:"Field Options"}),e.createElement(J.Z,null,e.createElement(A.l0,{showErrorList:!1,fields:{...g},noHtml5Validate:!0,formData:_,formContext:{fieldFormState:_},onSubmit:o=>h(o.formData),validator:se.ZP,schema:((l=s.schema)==null?void 0:l.uiOptions)||{},experimental_defaultFormStateBehavior:{allOf:"populateDefaults"}},e.createElement(j.Z,{variant:"contained",color:"primary",type:"submit",disabled:!((i=s.schema)!=null&&i.uiOptions)},"Apply"))))),e.createElement("div",{className:r.preview},e.createElement(Y.Z,null,e.createElement(H.Z,{title:"Example Template Spec"}),e.createElement(J.Z,null,e.createElement(oe.ZP,{readOnly:!0,theme:"dark",height:"100%",extensions:[ae.il.define(ne.r)],value:E}))),e.createElement(W,{key:u,content:E,contentIsSpec:!0,fieldExtensions:t,setErrorText:()=>null})))},Re=(0,U.Z)({root:{gridArea:"pageContent",display:"grid",gridTemplateAreas:`
      "browser editor preview"
      "results results results"
    `,gridTemplateColumns:"1fr 3fr 2fr",gridTemplateRows:"1fr auto"},browser:{gridArea:"browser",overflow:"auto"},editor:{gridArea:"editor",overflow:"auto"},preview:{gridArea:"preview",overflow:"auto"},results:{gridArea:"results"}}),Le=t=>{const n=Re(),[l,i]=(0,e.useState)();return e.createElement(v.D,{directory:t.directory},e.createElement(v.b,null,e.createElement("main",{className:n.root},e.createElement("section",{className:n.browser},e.createElement(v.T,{onClose:t.onClose})),e.createElement("section",{className:n.editor},e.createElement(v.c.DirectoryEditor,{errorText:l})),e.createElement("section",{className:n.preview},e.createElement(W.DirectoryEditorDryRun,{setErrorText:i,fieldExtensions:t.fieldExtensions,layouts:t.layouts})),e.createElement("section",{className:n.results},e.createElement(v.d,null)))))},We=`# Edit the template parameters below to see how they will render in the scaffolder form UI
parameters:
  - title: Fill in some steps
    required:
      - name
    properties:
      name:
        title: Name
        type: string
        description: Unique name of the component
      owner:
        title: Owner
        type: string
        description: Owner of the component
        ui:field: OwnerPicker
        ui:options:
          catalogFilter:
            kind: Group
  - title: Choose a location
    required:
      - repoUrl
    properties:
      repoUrl:
        title: Repository Location
        type: string
        ui:field: RepoUrlPicker
        ui:options:
          allowedHosts:
            - github.com
steps:
  - id: fetch-base
    name: Fetch Base
    action: fetch:template
    input:
      url: ./template
      values:
        name: \${{parameters.name}}
`,Ie=(0,U.Z)(t=>({root:{gridArea:"pageContent",display:"grid",gridTemplateAreas:`
      "controls controls"
      "textArea preview"
    `,gridTemplateRows:"auto 1fr",gridTemplateColumns:"1fr 1fr"},controls:{gridArea:"controls",display:"flex",flexFlow:"row nowrap",alignItems:"center",margin:t.spacing(1)},textArea:{gridArea:"textArea"},preview:{gridArea:"preview"}})),Ue=({defaultPreviewTemplate:t=We,customFieldExtensions:n=[],onClose:l,layouts:i=[]})=>{const r=Ie(),m=(0,R.u)(R.l),s=(0,R.u)(T.Ah),[p,_]=(0,e.useState)(""),[c,u]=(0,e.useState)(),[D,E]=(0,e.useState)([]),[g,M]=(0,e.useState)(t),{loading:h}=(0,ie.default)(()=>s.getEntities({filter:{kind:"template"},fields:["kind","metadata.namespace","metadata.name","metadata.title","spec.parameters","spec.steps","spec.output"]}).then(({items:d})=>E(d.map(y=>{var x;return{label:(x=y.metadata.title)!=null?x:(0,T.$3)(y,{defaultKind:"template"}),value:y}}))).catch(d=>m.post({message:`Error loading exisiting templates: ${d.message}`,severity:"error"})),[s]),o=(0,e.useCallback)(d=>{_(d),M(Z.ZP.stringify(d.spec))},[M]);return e.createElement(e.Fragment,null,h&&e.createElement(le.Z,null),e.createElement("main",{className:r.root},e.createElement("div",{className:r.controls},e.createElement($.Z,{variant:"outlined",size:"small",fullWidth:!0},e.createElement(G.Z,{id:"select-template-label"},"Load Existing Template"),e.createElement(V.Z,{value:p,label:"Load Existing Template",labelId:"select-template-label",onChange:d=>o(d.target.value)},D.map((d,y)=>e.createElement(X.Z,{key:y,value:d.value},d.label)))),e.createElement(F.Z,{size:"medium",onClick:l},e.createElement(Q.Z,null))),e.createElement("div",{className:r.textArea},e.createElement(v.c,{content:g,onUpdate:M,errorText:c})),e.createElement("div",{className:r.preview},e.createElement(W,{content:g,contentIsSpec:!0,fieldExtensions:n,setErrorText:u,layouts:i}))))};function xe(t){const[n,l]=(0,e.useState)();let i=null;return(n==null?void 0:n.type)==="local"?i=e.createElement(Le,{directory:n.directory,fieldExtensions:t.customFieldExtensions,onClose:()=>l(void 0),layouts:t.layouts}):(n==null?void 0:n.type)==="form"?i=e.createElement(Ue,{defaultPreviewTemplate:t.defaultPreviewTemplate,customFieldExtensions:t.customFieldExtensions,onClose:()=>l(void 0),layouts:t.layouts}):(n==null?void 0:n.type)==="field-explorer"?i=e.createElement(ye,{customFieldExtensions:t.customFieldExtensions,onClose:()=>l(void 0)}):i=e.createElement(O.VY,null,e.createElement(v.e,{onSelect:r=>{r==="local"?v.W.requestDirectoryAccess().then(m=>l({type:"local",directory:m})).catch(()=>{}):r==="form"?l({type:"form"}):r==="field-explorer"&&l({type:"field-explorer"})}})),e.createElement(O.T3,{themeId:"home"},e.createElement(O.h4,{title:"Template Editor",subtitle:"Edit, preview, and try out templates and template forms"}),i)}const Be=t=>{const{components:{TemplateCardComponent:n,TaskPageComponent:l=f.e,ReviewStepComponent:i,EXPERIMENTAL_TemplateOutputsComponent:r,EXPERIMENTAL_TemplateListPageComponent:m=ge,EXPERIMENTAL_TemplateWizardPageComponent:s=Pe}={}}=t,p=(0,P.pC)()||t.children,_=(0,z.PT)(p),c=[..._,...v.f.filter(({name:D})=>!_.some(E=>E.name===D))],u=(0,z.zS)(p);return e.createElement(P.Z5,null,e.createElement(P.AW,{path:"/",element:e.createElement(m,{TemplateCardComponent:n,contextMenu:t.contextMenu,groups:t.groups,templateFilter:t.templateFilter,headerOptions:t.headerOptions})}),e.createElement(P.AW,{path:f.o.path,element:e.createElement(I.S,null,e.createElement(s,{headerOptions:t.headerOptions,customFieldExtensions:c,layouts:u,components:{ReviewStepComponent:i},formProps:t.formProps}))}),e.createElement(P.AW,{path:f.w.path,element:e.createElement(l,{TemplateOutputsComponent:r})}),e.createElement(P.AW,{path:f.p.path,element:e.createElement(I.S,null,e.createElement(xe,{customFieldExtensions:c,layouts:u}))}),e.createElement(P.AW,{path:f.q.path,element:e.createElement(v.A,null)}),e.createElement(P.AW,{path:f.t.path,element:e.createElement(v.L,null)}),e.createElement(P.AW,{path:"*",element:e.createElement(O.mf,{status:"404",statusMessage:"Page not found"})}))}}}]);})();

//# sourceMappingURL=2719.e5a36aa3.chunk.js.map