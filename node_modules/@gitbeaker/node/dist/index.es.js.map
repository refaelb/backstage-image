{"version":3,"file":"index.es.js","sources":["../src/GotRequester.ts","../src/index.ts"],"sourcesContent":["import Got from 'got';\nimport { decamelizeKeys } from 'xcase';\nimport delay from 'delay';\nimport {\n  DefaultResourceOptions,\n  DefaultRequestReturn,\n  DefaultRequestOptions,\n  createRequesterFn,\n  defaultOptionsHandler as baseOptionsHandler,\n} from '@gitbeaker/requester-utils';\n\nexport function defaultOptionsHandler(\n  resourceOptions: DefaultResourceOptions,\n  { body, query, sudo, method }: DefaultRequestOptions = {},\n): DefaultRequestReturn & {\n  json?: Record<string, unknown>;\n  https?: { rejectUnauthorized: boolean };\n} {\n  const options: DefaultRequestReturn & {\n    json?: Record<string, unknown>;\n    https?: { rejectUnauthorized: boolean };\n  } = baseOptionsHandler(resourceOptions, { body, query, sudo, method });\n\n  // FIXME: Not the best comparison, but...it will have to do for now.\n  if (typeof body === 'object' && body.constructor.name !== 'FormData') {\n    options.json = decamelizeKeys(body);\n\n    delete options.body;\n  }\n\n  if (\n    resourceOptions.url.includes('https') &&\n    resourceOptions.rejectUnauthorized != null &&\n    resourceOptions.rejectUnauthorized === false\n  ) {\n    options.https = {\n      rejectUnauthorized: resourceOptions.rejectUnauthorized,\n    };\n  }\n\n  return options;\n}\n\nexport function processBody({\n  rawBody,\n  headers,\n}: {\n  rawBody: Buffer;\n  headers: Record<string, unknown>;\n}) {\n  // Split to remove potential charset info from the content type\n  const contentType = ((headers['content-type'] as string) || '').split(';')[0].trim();\n\n  if (contentType === 'application/json') {\n    return rawBody.length === 0 ? {} : JSON.parse(rawBody.toString());\n  }\n\n  if (contentType.startsWith('text/')) {\n    return rawBody.toString();\n  }\n\n  return Buffer.from(rawBody);\n}\n\nexport async function handler(endpoint: string, options: Record<string, unknown>) {\n  const retryCodes = [429, 502];\n  const maxRetries = 10;\n  let response;\n\n  for (let i = 0; i < maxRetries; i += 1) {\n    const waitTime = 2 ** i * 0.1;\n    try {\n      if (options.method === 'stream') {\n        return Got(endpoint, { ...options, method: 'get', isStream: true });\n      }\n\n      response = await Got(endpoint, options); // eslint-disable-line\n      break;\n    } catch (e) {\n      if (e.response) {\n        if (retryCodes.includes(e.response.statusCode)) {\n          await delay(waitTime); // eslint-disable-line\n          continue; // eslint-disable-line\n        }\n\n        if (typeof e.response.body === 'string' && e.response.body.length > 0) {\n          try {\n            const output = JSON.parse(e.response.body);\n            e.description = output.error || output.message;\n          } catch (err) {\n            e.description = e.response.body;\n          }\n        }\n      }\n\n      throw e;\n    }\n  }\n\n  const { statusCode, headers } = response;\n\n  const body = processBody(response);\n\n  return { body, headers, status: statusCode };\n}\n\nexport const requesterFn = createRequesterFn(defaultOptionsHandler, handler);\n","import { Resources } from '@gitbeaker/core';\nimport { presetResourceArguments } from '@gitbeaker/requester-utils';\nimport { requesterFn } from './GotRequester';\n\nconst API = presetResourceArguments(Resources, { requesterFn });\n\nexport { Types } from '@gitbeaker/core';\n\nexport const {\n  // Groups\n  Groups,\n  GroupAccessRequests,\n  GroupBadges,\n  GroupCustomAttributes,\n  GroupIssueBoards,\n  GroupMembers,\n  GroupMilestones,\n  GroupRunners,\n  GroupVariables,\n  GroupLabels,\n  GroupDeployTokens,\n  Epics,\n  EpicIssues,\n  EpicNotes,\n  EpicDiscussions,\n\n  // Users\n  Users,\n  UserCustomAttributes,\n  UserEmails,\n  UserImpersonationTokens,\n  UserSSHKeys,\n  UserGPGKeys,\n\n  // Projects\n  Branches,\n  Commits,\n  CommitDiscussions,\n  ContainerRegistry,\n  Deployments,\n  DeployKeys,\n  Environments,\n  FreezePeriods,\n  Issues,\n  IssuesStatistics,\n  IssueNotes,\n  IssueNoteAwardEmojis,\n  IssueDiscussions,\n  IssueAwardEmojis,\n  Jobs,\n  Labels,\n  MergeRequests,\n  MergeRequestApprovals,\n  MergeRequestAwardEmojis,\n  MergeRequestDiscussions,\n  MergeRequestNotes,\n  Packages,\n  PackageRegistry,\n  Pipelines,\n  PipelineSchedules,\n  PipelineScheduleVariables,\n  Projects,\n  ProjectAccessRequests,\n  ProjectBadges,\n  ProjectCustomAttributes,\n  ProjectImportExport,\n  ProjectIssueBoards,\n  ProjectHooks,\n  ProjectMembers,\n  ProjectMilestones,\n  ProjectSnippets,\n  ProjectSnippetNotes,\n  ProjectSnippetDiscussions,\n  ProjectSnippetAwardEmojis,\n  ProtectedBranches,\n  ProtectedTags,\n  ProjectVariables,\n  ProjectDeployTokens,\n  PushRules,\n  Releases,\n  ReleaseLinks,\n  Repositories,\n  RepositoryFiles,\n  RepositorySubmodules,\n  Runners,\n  Services,\n  Tags,\n  Todos,\n  Triggers,\n  VulnerabilityFindings,\n\n  // Genral\n  ApplicationSettings,\n  BroadcastMessages,\n  Events,\n  FeatureFlags,\n  GeoNodes,\n  GitignoreTemplates,\n  GitLabCIYMLTemplates,\n  Keys,\n  License,\n  LicenseTemplates,\n  Lint,\n  Namespaces,\n  NotificationSettings,\n  Markdown,\n  PagesDomains,\n  Search,\n  SidekiqMetrics,\n  Snippets,\n  SystemHooks,\n  Version,\n  Wikis,\n\n  Gitlab,\n} = API;\n"],"names":["baseOptionsHandler"],"mappings":"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"}