import n,{useMemo as g,useState as h,useEffect as v}from"react";import{DateTime as i}from"luxon";import{Snackbar as b}from"@material-ui/core";import{Alert as l}from"@material-ui/lab";import{useApi as A,fetchApiRef as S}from"@backstage/core-plugin-api";import{LicenseState as s}from"@spotify/backstage-plugin-core-common";import{default as Y}from"tiny-invariant";import k from"react-use/lib/useUpdate";import L from"react-use/lib/useInterval";var p=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)},T=(e,t,r)=>(p(e,t,"read from private field"),r?r.call(e):t.get(e)),D=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},w=(e,t,r,a)=>(p(e,t,"write to private field"),a?a.call(e,r):t.set(e,r),r),c;class I{constructor(t){D(this,c,void 0),w(this,c,t.fetchApi)}async validate(t){return(await T(this,c).fetch(`plugin://${t}/validate-license`)).json()}}c=new WeakMap;function u(e){const{fetchApi:t,backend:r}=e,a=g(()=>new I({fetchApi:t}),[t]),[o,d]=h(void 0);return v(()=>{async function y(){const E=await a.validate(r);d(E)}y()},[a,r]),{response:o}}const M=({expiry:e})=>{const t=i.fromISO(e);return n.createElement(l,{severity:"info"},"Spotify plugins are in trial mode. The trial license key for the Spotify plugin bundle will expire on ",t.toLocaleString(i.DATE_MED),".")},x=({invalidLicenseMessage:e})=>n.createElement(l,{severity:"error"},"The license key that you entered for the Spotify Plugins for Backstage bundle subscription could not be validated. Something might have gone wrong on our end, or if this is a newly-entered license key perhaps some characters were missed. Please double check that the key entered in spotify.licenseKey in your app-config.yaml matches the key you received from Spotify.",e?n.createElement(n.Fragment,null,n.createElement("br",null),n.createElement("br",null),e):null),_=({expiry:e,finalExpiry:t})=>{const r=i.fromISO(e),a=i.fromISO(t);return n.createElement(l,{severity:"warning"},"The license key for your Spotify Plugins for Backstage bundle subscription expired on ",r.toLocaleString(i.DATE_MED),". The plugins will continue working under a grace period until"," ",a.toLocaleString(i.DATE_MED),".")},R=({invalidLicenseMessage:e})=>n.createElement(l,{severity:"error"},"To use this Spotify Plugin for Backstage, you must have a license key. This plugin is part of a paid bundle subscription offered by Spotify to enhance the free, open-source Backstage project. If you have a license key, make sure it is entered in app-config.yaml as spotify.licenseKey.",e?n.createElement(n.Fragment,null,n.createElement("br",null),n.createElement("br",null),e):null),B=({invalidLicenseMessage:e,expiry:t})=>{const r=i.fromISO(t);return n.createElement(l,{severity:"error"},"The license key for your Spotify Plugin for Backstage bundle subscription expired on ",r.toLocaleString(i.DATE_MED),".",e?n.createElement(n.Fragment,null,n.createElement("br",null),n.createElement("br",null),e):null)},f=({response:e,invalidLicenseMessage:t})=>{var r;switch(e.state){case s.VALID:return null;case s.TRIAL:return n.createElement(M,{expiry:e.expiry});case s.INVALID:return n.createElement(x,{invalidLicenseMessage:t});case s.EXPIRED:case s.TRIAL_EXPIRED:return n.createElement(_,{expiry:e.expiry,finalExpiry:e.finalExpiry});case s.PAST_GRACE_PERIOD:return n.createElement(B,{expiry:e.expiry,invalidLicenseMessage:t});case s.NO_KEY_DEFINED:return n.createElement(R,{invalidLicenseMessage:t});default:return n.createElement(l,{severity:"warning"},(r=e.message)!=null?r:"Spotify plugin license: Unknown error")}},P=({backend:e,invalidLicenseMessage:t,inline:r})=>{const a=A(S),{response:o}=u({fetchApi:a,backend:e});return!o||o.state===s.VALID?null:r?n.createElement(f,{response:o,invalidLicenseMessage:t}):n.createElement(b,{open:!0,"data-testid":"license-banner-snackbar",anchorOrigin:{vertical:"top",horizontal:"center"}},n.createElement(f,{response:o,invalidLicenseMessage:t}))},F=["#3C00E4","#F036A4","#088569","#FF4834","#0D72EA","#8A202B","#8400E7","#5F8008","#324B64","#BC5900"],O=["#3394d3","#e01f61","#2fc46e","#9657af","#ffd300","#de7a24","#1bb697","#909fa1","#008db4","#a71755"],C=1,V=60*1e3;function m(e){const t=i.fromISO(e);return i.now().diff(t).as("minutes")<C?"now":t.toRelative()}const K=e=>{const t=m(e),r=k();return L(r,V),t};export{O as DATA_VIZ_DARK_THEME,F as DATA_VIZ_LIGHT_THEME,P as SpotifyLicenseBanner,m as getRelativeTime,Y as invariant,K as useAutoUpdatingRelativeTime,u as useSpotifyLicense};
//# sourceMappingURL=index.esm.js.map
