"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.useControlledRerenderState = void 0;
const react_1 = require("react");
const useFirstMountState_1 = require("../useFirstMountState");
const useRerender_1 = require("../useRerender");
const resolveHookState_1 = require("../util/resolveHookState");
/**
 * Like `React.useState`, but its state setter accepts extra argument, that allows to cancel
 * rerender.
 */
function useControlledRerenderState(initialState) {
    const state = (0, react_1.useRef)((0, useFirstMountState_1.useFirstMountState)() ? (0, resolveHookState_1.resolveHookState)(initialState) : undefined);
    const rr = (0, useRerender_1.useRerender)();
    return [
        state.current,
        (0, react_1.useCallback)((value, rerender) => {
            const newState = (0, resolveHookState_1.resolveHookState)(value, state.current);
            if (newState !== state.current) {
                state.current = newState;
                if (rerender === undefined || rerender) {
                    rr();
                }
            }
        }, []),
    ];
}
exports.useControlledRerenderState = useControlledRerenderState;
