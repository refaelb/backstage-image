import { useCallback, useState } from 'react';
import { useSyncedRef } from '../useSyncedRef';
import { resolveHookState } from "../util/resolveHookState.js";
/**
 * Like `useState`, but every value set is passed through a mediator function.
 */
export function useMediatedState(initialState, mediator) {
    const [state, setState] = useState(() => {
        return mediator ? mediator(resolveHookState(initialState)) : initialState;
    });
    const mediatorRef = useSyncedRef(mediator);
    return [
        state,
        useCallback((value) => {
            if (mediatorRef.current) {
                setState((prevState) => mediatorRef.current?.(resolveHookState(value, prevState)));
            }
            else {
                setState(value);
            }
        }, []),
    ];
}
