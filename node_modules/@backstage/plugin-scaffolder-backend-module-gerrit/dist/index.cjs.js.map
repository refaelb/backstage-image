{"version":3,"file":"index.cjs.js","sources":["../src/actions/gerrit.examples.ts","../src/actions/gerrit.ts","../src/actions/gerritReview.ts"],"sourcesContent":["/*\n * Copyright 2023 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { TemplateExample } from '@backstage/plugin-scaffolder-node';\nimport yaml from 'yaml';\n\nexport const examples: TemplateExample[] = [\n  {\n    description:\n      'Initializes a Gerrit repository of contents in workspace and publish it to Gerrit with default configuration.',\n    example: yaml.stringify({\n      steps: [\n        {\n          id: 'publish',\n          action: 'publish:gerrit',\n          name: 'Publish to Gerrit',\n          input: {\n            repoUrl: 'gerrit.com?repo=repo&owner=owner',\n          },\n        },\n      ],\n    }),\n  },\n  {\n    description: 'Initializes a Gerrit repository with a description.',\n    example: yaml.stringify({\n      steps: [\n        {\n          id: 'publish',\n          action: 'publish:gerrit',\n          name: 'Publish to Gerrit',\n          input: {\n            repoUrl: 'gerrit.com?repo=repo&owner=owner',\n            description: 'Initialize a gerrit repository',\n          },\n        },\n      ],\n    }),\n  },\n  {\n    description:\n      'Initializes a Gerrit repository with a default Branch, if not set defaults to master',\n    example: yaml.stringify({\n      steps: [\n        {\n          id: 'publish',\n          action: 'publish:gerrit',\n          name: 'Publish to Gerrit',\n          input: {\n            repoUrl: 'gerrit.com?repo=repo&owner=owner',\n            defaultBranch: 'staging',\n          },\n        },\n      ],\n    }),\n  },\n  {\n    description:\n      'Initializes a Gerrit repository with an initial commit message, if not set defaults to initial commit',\n    example: yaml.stringify({\n      steps: [\n        {\n          id: 'publish',\n          action: 'publish:gerrit',\n          name: 'Publish to Gerrit',\n          input: {\n            repoUrl: 'gerrit.com?repo=repo&owner=owner',\n            gitCommitMessage: 'Initial Commit Message',\n          },\n        },\n      ],\n    }),\n  },\n  {\n    description:\n      'Initializes a Gerrit repository with a repo Author Name, if not set defaults to Scaffolder',\n    example: yaml.stringify({\n      steps: [\n        {\n          id: 'publish',\n          action: 'publish:gerrit',\n          name: 'Publish to Gerrit',\n          input: {\n            repoUrl: 'gerrit.com?repo=repo&owner=owner',\n            gitAuthorName: 'John Doe',\n          },\n        },\n      ],\n    }),\n  },\n  {\n    description: 'Initializes a Gerrit repository with a repo Author Email',\n    example: yaml.stringify({\n      steps: [\n        {\n          id: 'publish',\n          action: 'publish:gerrit',\n          name: 'Publish to Gerrit',\n          input: {\n            repoUrl: 'gerrit.com?repo=repo&owner=owner',\n            gitAuthorEmail: 'johndoe@email.com',\n          },\n        },\n      ],\n    }),\n  },\n  {\n    description:\n      'Path within the workspace that will be used as the repository root. If omitted, the entire workspace will be published as the repository',\n    example: yaml.stringify({\n      steps: [\n        {\n          id: 'publish',\n          action: 'publish:gerrit',\n          name: 'Publish to Gerrit',\n          input: {\n            repoUrl: 'gerrit.com?repo=repo&owner=owner',\n            sourcePath: 'repository/',\n          },\n        },\n      ],\n    }),\n  },\n  {\n    description:\n      'Initializes a Gerrit repository with all proporties being set',\n    example: yaml.stringify({\n      steps: [\n        {\n          id: 'publish',\n          action: 'publish:gerrit',\n          name: 'Publish to Gerrit',\n          input: {\n            repoUrl: 'gerrit.com?repo=repo&owner=owner',\n            description: 'Initialize a gerrit repository',\n            defaultBranch: 'staging',\n            gitCommitMessage: 'Initial Commit Message',\n            gitAuthorName: 'John Doe',\n            gitAuthorEmail: 'johndoe@email.com',\n            sourcePath: 'repository/',\n          },\n        },\n      ],\n    }),\n  },\n];\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport crypto from 'crypto';\nimport { InputError } from '@backstage/errors';\nimport { Config } from '@backstage/config';\nimport {\n  GerritIntegrationConfig,\n  getGerritRequestOptions,\n  ScmIntegrationRegistry,\n} from '@backstage/integration';\nimport {\n  createTemplateAction,\n  initRepoAndPush,\n  getRepoSourceDirectory,\n  parseRepoUrl,\n} from '@backstage/plugin-scaffolder-node';\nimport fetch, { Response, RequestInit } from 'node-fetch';\nimport { examples } from './gerrit.examples';\n\nconst createGerritProject = async (\n  config: GerritIntegrationConfig,\n  options: {\n    projectName: string;\n    parent: string;\n    owner?: string;\n    description: string;\n  },\n): Promise<void> => {\n  const { projectName, parent, owner, description } = options;\n\n  const fetchOptions: RequestInit = {\n    method: 'PUT',\n    body: JSON.stringify({\n      parent,\n      description,\n      owners: owner ? [owner] : [],\n      create_empty_commit: false,\n    }),\n    headers: {\n      ...getGerritRequestOptions(config).headers,\n      'Content-Type': 'application/json',\n    },\n  };\n  const response: Response = await fetch(\n    `${config.baseUrl}/a/projects/${encodeURIComponent(projectName)}`,\n    fetchOptions,\n  );\n  if (response.status !== 201) {\n    throw new Error(\n      `Unable to create repository, ${response.status} ${\n        response.statusText\n      }, ${await response.text()}`,\n    );\n  }\n};\n\nconst generateCommitMessage = (\n  config: Config,\n  commitSubject?: string,\n): string => {\n  const changeId = crypto.randomBytes(20).toString('hex');\n  const msg = `${\n    config.getOptionalString('scaffolder.defaultCommitMessage') || commitSubject\n  }\\n\\nChange-Id: I${changeId}`;\n  return msg;\n};\n\n/**\n * Creates a new action that initializes a git repository of the content in the workspace\n * and publishes it to a Gerrit instance.\n * @public\n */\nexport function createPublishGerritAction(options: {\n  integrations: ScmIntegrationRegistry;\n  config: Config;\n}) {\n  const { integrations, config } = options;\n\n  return createTemplateAction<{\n    repoUrl: string;\n    description: string;\n    defaultBranch?: string;\n    gitCommitMessage?: string;\n    gitAuthorName?: string;\n    gitAuthorEmail?: string;\n    sourcePath?: string;\n  }>({\n    id: 'publish:gerrit',\n    supportsDryRun: true,\n    description:\n      'Initializes a git repository of the content in the workspace, and publishes it to Gerrit.',\n    examples,\n    schema: {\n      input: {\n        type: 'object',\n        required: ['repoUrl'],\n        properties: {\n          repoUrl: {\n            title: 'Repository Location',\n            type: 'string',\n          },\n          description: {\n            title: 'Repository Description',\n            type: 'string',\n          },\n          defaultBranch: {\n            title: 'Default Branch',\n            type: 'string',\n            description: `Sets the default branch on the repository. The default value is 'master'`,\n          },\n          gitCommitMessage: {\n            title: 'Git Commit Message',\n            type: 'string',\n            description: `Sets the commit message on the repository. The default value is 'initial commit'`,\n          },\n          gitAuthorName: {\n            title: 'Default Author Name',\n            type: 'string',\n            description: `Sets the default author name for the commit. The default value is 'Scaffolder'`,\n          },\n          gitAuthorEmail: {\n            title: 'Default Author Email',\n            type: 'string',\n            description: `Sets the default author email for the commit.`,\n          },\n          sourcePath: {\n            title: 'Source Path',\n            type: 'string',\n            description: `Path within the workspace that will be used as the repository root. If omitted, the entire workspace will be published as the repository.`,\n          },\n        },\n      },\n      output: {\n        type: 'object',\n        properties: {\n          remoteUrl: {\n            title: 'A URL to the repository with the provider',\n            type: 'string',\n          },\n          repoContentsUrl: {\n            title: 'A URL to the root of the repository',\n            type: 'string',\n          },\n          commitHash: {\n            title: 'The git commit hash of the initial commit',\n            type: 'string',\n          },\n        },\n      },\n    },\n    async handler(ctx) {\n      const {\n        repoUrl,\n        description,\n        defaultBranch = 'master',\n        gitAuthorName,\n        gitAuthorEmail,\n        gitCommitMessage = 'initial commit',\n        sourcePath,\n      } = ctx.input;\n      const { repo, host, owner, workspace } = parseRepoUrl(\n        repoUrl,\n        integrations,\n      );\n\n      const integrationConfig = integrations.gerrit.byHost(host);\n\n      if (!integrationConfig) {\n        throw new InputError(\n          `No matching integration configuration for host ${host}, please check your integrations config`,\n        );\n      }\n\n      if (!workspace) {\n        throw new InputError(\n          `Invalid URL provider was included in the repo URL to create ${ctx.input.repoUrl}, missing workspace`,\n        );\n      }\n\n      const repoContentsUrl = `${integrationConfig.config.gitilesBaseUrl}/${repo}/+/refs/heads/${defaultBranch}`;\n      const remoteUrl = `${integrationConfig.config.cloneUrl}/a/${repo}`;\n      const gitName = gitAuthorName\n        ? gitAuthorName\n        : config.getOptionalString('scaffolder.defaultAuthor.name');\n      const gitEmail = gitAuthorEmail\n        ? gitAuthorEmail\n        : config.getOptionalString('scaffolder.defaultAuthor.email');\n      const commitMessage = generateCommitMessage(config, gitCommitMessage);\n\n      if (ctx.isDryRun) {\n        ctx.logger.info(\n          `Dry run arguments: ${{\n            gitName,\n            gitEmail,\n            commitMessage,\n            ...ctx.input,\n          }}`,\n        );\n        ctx.output('remoteUrl', remoteUrl);\n        ctx.output('commitHash', 'abcd-dry-run-1234');\n        ctx.output('repoContentsUrl', repoContentsUrl);\n        return;\n      }\n\n      await createGerritProject(integrationConfig.config, {\n        description,\n        owner: owner,\n        projectName: repo,\n        parent: workspace,\n      });\n      const auth = {\n        username: integrationConfig.config.username!,\n        password: integrationConfig.config.password!,\n      };\n      const gitAuthorInfo = {\n        name: gitName,\n        email: gitEmail,\n      };\n\n      const commitResult = await initRepoAndPush({\n        dir: getRepoSourceDirectory(ctx.workspacePath, sourcePath),\n        remoteUrl,\n        auth,\n        defaultBranch,\n        logger: ctx.logger,\n        commitMessage: generateCommitMessage(config, gitCommitMessage),\n        gitAuthorInfo,\n      });\n\n      ctx.output('remoteUrl', remoteUrl);\n      ctx.output('commitHash', commitResult?.commitHash);\n      ctx.output('repoContentsUrl', repoContentsUrl);\n    },\n  });\n}\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport crypto from 'crypto';\nimport { InputError } from '@backstage/errors';\nimport { Config } from '@backstage/config';\nimport { ScmIntegrationRegistry } from '@backstage/integration';\nimport {\n  createTemplateAction,\n  commitAndPushRepo,\n  getRepoSourceDirectory,\n  parseRepoUrl,\n} from '@backstage/plugin-scaffolder-node';\n\nconst generateGerritChangeId = (): string => {\n  const changeId = crypto.randomBytes(20).toString('hex');\n  return `I${changeId}`;\n};\n\n/**\n * Creates a new action that creates a Gerrit review\n * @public\n */\nexport function createPublishGerritReviewAction(options: {\n  integrations: ScmIntegrationRegistry;\n  config: Config;\n}) {\n  const { integrations, config } = options;\n\n  return createTemplateAction<{\n    repoUrl: string;\n    branch?: string;\n    sourcePath?: string;\n    gitCommitMessage?: string;\n    gitAuthorName?: string;\n    gitAuthorEmail?: string;\n  }>({\n    id: 'publish:gerrit:review',\n    description: 'Creates a new Gerrit review.',\n    schema: {\n      input: {\n        type: 'object',\n        required: ['repoUrl', 'gitCommitMessage'],\n        properties: {\n          repoUrl: {\n            title: 'Repository Location',\n            type: 'string',\n          },\n          branch: {\n            title: 'Repository branch',\n            type: 'string',\n            description:\n              'Branch of the repository the review will be created on',\n          },\n          sourcePath: {\n            type: 'string',\n            title: 'Working Subdirectory',\n            description:\n              'Subdirectory of working directory containing the repository',\n          },\n          gitCommitMessage: {\n            title: 'Git Commit Message',\n            type: 'string',\n            description: `Sets the commit message on the repository.`,\n          },\n          gitAuthorName: {\n            title: 'Default Author Name',\n            type: 'string',\n            description: `Sets the default author name for the commit. The default value is 'Scaffolder'`,\n          },\n          gitAuthorEmail: {\n            title: 'Default Author Email',\n            type: 'string',\n            description: `Sets the default author email for the commit.`,\n          },\n        },\n      },\n      output: {\n        type: 'object',\n        properties: {\n          reviewUrl: {\n            title: 'A URL to the review',\n            type: 'string',\n          },\n          repoContentsUrl: {\n            title: 'A URL to the root of the repository',\n            type: 'string',\n          },\n        },\n      },\n    },\n    async handler(ctx) {\n      const {\n        repoUrl,\n        branch = 'master',\n        sourcePath,\n        gitAuthorName,\n        gitAuthorEmail,\n        gitCommitMessage,\n      } = ctx.input;\n      const { host, repo } = parseRepoUrl(repoUrl, integrations);\n\n      if (!gitCommitMessage) {\n        throw new InputError(`Missing gitCommitMessage input`);\n      }\n\n      const integrationConfig = integrations.gerrit.byHost(host);\n\n      if (!integrationConfig) {\n        throw new InputError(\n          `No matching integration configuration for host ${host}, please check your integrations config`,\n        );\n      }\n\n      const auth = {\n        username: integrationConfig.config.username!,\n        password: integrationConfig.config.password!,\n      };\n      const gitAuthorInfo = {\n        name: gitAuthorName\n          ? gitAuthorName\n          : config.getOptionalString('scaffolder.defaultAuthor.name'),\n        email: gitAuthorEmail\n          ? gitAuthorEmail\n          : config.getOptionalString('scaffolder.defaultAuthor.email'),\n      };\n      const changeId = generateGerritChangeId();\n      const commitMessage = `${gitCommitMessage}\\n\\nChange-Id: ${changeId}`;\n\n      await commitAndPushRepo({\n        dir: getRepoSourceDirectory(ctx.workspacePath, sourcePath),\n        auth,\n        logger: ctx.logger,\n        commitMessage,\n        gitAuthorInfo,\n        branch,\n        remoteRef: `refs/for/${branch}`,\n      });\n\n      const repoContentsUrl = `${integrationConfig.config.gitilesBaseUrl}/${repo}/+/refs/heads/${branch}`;\n      const reviewUrl = `${integrationConfig.config.baseUrl}/#/q/${changeId}`;\n      ctx.logger?.info(`Review available on ${reviewUrl}`);\n      ctx.output('repoContentsUrl', repoContentsUrl);\n      ctx.output('reviewUrl', reviewUrl);\n    },\n  });\n}\n"],"names":["yaml","getGerritRequestOptions","fetch","crypto","createTemplateAction","parseRepoUrl","InputError","initRepoAndPush","getRepoSourceDirectory","commitAndPushRepo"],"mappings":"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"}