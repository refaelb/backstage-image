{"version":3,"file":"index.esm.js","sources":["../src/components/EntityRelationsGraph/DefaultRenderLabel.tsx","../src/components/EntityRelationsGraph/EntityKindIcon.tsx","../src/components/EntityRelationsGraph/DefaultRenderNode.tsx","../src/components/EntityRelationsGraph/relations.ts","../src/components/EntityRelationsGraph/types.ts","../src/components/EntityRelationsGraph/useEntityStore.ts","../src/components/EntityRelationsGraph/useEntityRelationGraph.ts","../src/components/EntityRelationsGraph/useEntityRelationNodesAndEdges.ts","../src/components/EntityRelationsGraph/EntityRelationsGraph.tsx","../src/routes.ts","../src/plugin.ts","../src/extensions.tsx"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { DependencyGraphTypes } from '@backstage/core-components';\nimport makeStyles from '@material-ui/core/styles/makeStyles';\nimport React from 'react';\nimport { EntityEdgeData } from './types';\nimport classNames from 'classnames';\n\nconst useStyles = makeStyles(\n  theme => ({\n    text: {\n      fill: theme.palette.textContrast,\n    },\n    secondary: {\n      fill: theme.palette.textSubtle,\n    },\n  }),\n  { name: 'PluginCatalogGraphCustomLabel' },\n);\n\nexport function DefaultRenderLabel({\n  edge: { relations },\n}: DependencyGraphTypes.RenderLabelProps<EntityEdgeData>) {\n  const classes = useStyles();\n  return (\n    <text className={classes.text} textAnchor=\"middle\">\n      {relations.map((r, i) => (\n        <tspan key={r} className={classNames(i > 0 && classes.secondary)}>\n          {i > 0 && <tspan> / </tspan>}\n          {r}\n        </tspan>\n      ))}\n    </text>\n  );\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { useApp } from '@backstage/core-plugin-api';\nimport WorkIcon from '@material-ui/icons/Work';\nimport React from 'react';\n\nexport function EntityKindIcon({\n  kind,\n  ...props\n}: {\n  kind: string;\n  x?: number;\n  y?: number;\n  width?: number;\n  height?: number;\n  className?: string;\n}) {\n  const app = useApp();\n  const Icon =\n    app.getSystemIcon(`kind:${kind.toLocaleLowerCase('en-US')}`) ?? WorkIcon;\n  return <Icon {...props} />;\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { DependencyGraphTypes } from '@backstage/core-components';\nimport { humanizeEntityRef } from '@backstage/plugin-catalog-react';\nimport { makeStyles } from '@material-ui/core/styles';\nimport classNames from 'classnames';\nimport React, { useLayoutEffect, useRef, useState } from 'react';\nimport { EntityKindIcon } from './EntityKindIcon';\nimport { EntityNodeData } from './types';\nimport { DEFAULT_NAMESPACE } from '@backstage/catalog-model';\n\nconst useStyles = makeStyles(\n  theme => ({\n    node: {\n      fill: theme.palette.grey[300],\n      stroke: theme.palette.grey[300],\n\n      '&.primary': {\n        fill: theme.palette.primary.light,\n        stroke: theme.palette.primary.light,\n      },\n      '&.secondary': {\n        fill: theme.palette.secondary.light,\n        stroke: theme.palette.secondary.light,\n      },\n    },\n    text: {\n      fill: theme.palette.getContrastText(theme.palette.grey[300]),\n\n      '&.primary': {\n        fill: theme.palette.primary.contrastText,\n      },\n      '&.secondary': {\n        fill: theme.palette.secondary.contrastText,\n      },\n      '&.focused': {\n        fontWeight: 'bold',\n      },\n    },\n    clickable: {\n      cursor: 'pointer',\n    },\n  }),\n  { name: 'PluginCatalogGraphCustomNode' },\n);\n\nexport function DefaultRenderNode({\n  node: { id, entity, color = 'default', focused, onClick },\n}: DependencyGraphTypes.RenderNodeProps<EntityNodeData>) {\n  const classes = useStyles();\n  const [width, setWidth] = useState(0);\n  const [height, setHeight] = useState(0);\n  const idRef = useRef<SVGTextElement | null>(null);\n\n  useLayoutEffect(() => {\n    // set the width to the length of the ID\n    if (idRef.current) {\n      let { height: renderedHeight, width: renderedWidth } =\n        idRef.current.getBBox();\n      renderedHeight = Math.round(renderedHeight);\n      renderedWidth = Math.round(renderedWidth);\n\n      if (renderedHeight !== height || renderedWidth !== width) {\n        setWidth(renderedWidth);\n        setHeight(renderedHeight);\n      }\n    }\n  }, [width, height]);\n\n  const {\n    kind,\n    metadata: { name, namespace = DEFAULT_NAMESPACE, title },\n  } = entity;\n\n  const padding = 10;\n  const iconSize = height;\n  const paddedIconWidth = kind ? iconSize + padding : 0;\n  const paddedWidth = paddedIconWidth + width + padding * 2;\n  const paddedHeight = height + padding * 2;\n\n  const displayTitle =\n    title ??\n    (kind && name && namespace\n      ? humanizeEntityRef({ kind, name, namespace })\n      : id);\n\n  return (\n    <g onClick={onClick} className={classNames(onClick && classes.clickable)}>\n      <rect\n        className={classNames(\n          classes.node,\n          color === 'primary' && 'primary',\n          color === 'secondary' && 'secondary',\n        )}\n        width={paddedWidth}\n        height={paddedHeight}\n        rx={10}\n      />\n      {kind && (\n        <EntityKindIcon\n          kind={kind}\n          y={padding}\n          x={padding}\n          width={iconSize}\n          height={iconSize}\n          className={classNames(\n            classes.text,\n            focused && 'focused',\n            color === 'primary' && 'primary',\n            color === 'secondary' && 'secondary',\n          )}\n        />\n      )}\n      <text\n        ref={idRef}\n        className={classNames(\n          classes.text,\n          focused && 'focused',\n          color === 'primary' && 'primary',\n          color === 'secondary' && 'secondary',\n        )}\n        y={paddedHeight / 2}\n        x={paddedIconWidth + (width + padding * 2) / 2}\n        textAnchor=\"middle\"\n        alignmentBaseline=\"middle\"\n      >\n        {displayTitle}\n      </text>\n    </g>\n  );\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {\n  RELATION_API_CONSUMED_BY,\n  RELATION_API_PROVIDED_BY,\n  RELATION_CHILD_OF,\n  RELATION_CONSUMES_API,\n  RELATION_DEPENDENCY_OF,\n  RELATION_DEPENDS_ON,\n  RELATION_HAS_MEMBER,\n  RELATION_HAS_PART,\n  RELATION_MEMBER_OF,\n  RELATION_OWNED_BY,\n  RELATION_OWNER_OF,\n  RELATION_PARENT_OF,\n  RELATION_PART_OF,\n  RELATION_PROVIDES_API,\n} from '@backstage/catalog-model';\n\n/**\n * A pair of two relations that describe the opposite of each other. The first\n * relation is considered as the primary relation.\n *\n * @public\n */\nexport type RelationPairs = [string, string][];\n\n// TODO: This file only contains the pairs for the built-in relations.\n//  How to implement this when custom relations are used? Right now you can pass\n//  the relations everywhere.\n//  Another option is to move this into @backstage/catalog-model\n\n/**\n * A list of pairs of entity relations, used to define which relations are\n * merged together and which the primary relation is.\n *\n * @public\n */\nexport const ALL_RELATION_PAIRS: RelationPairs = [\n  [RELATION_OWNER_OF, RELATION_OWNED_BY],\n  [RELATION_CONSUMES_API, RELATION_API_CONSUMED_BY],\n  [RELATION_API_PROVIDED_BY, RELATION_PROVIDES_API],\n  [RELATION_HAS_PART, RELATION_PART_OF],\n  [RELATION_PARENT_OF, RELATION_CHILD_OF],\n  [RELATION_HAS_MEMBER, RELATION_MEMBER_OF],\n  [RELATION_DEPENDS_ON, RELATION_DEPENDENCY_OF],\n];\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DependencyGraphTypes } from '@backstage/core-components';\nimport { MouseEventHandler } from 'react';\nimport { Entity } from '@backstage/catalog-model';\nimport { JsonObject } from '@backstage/types';\n\n/**\n * Additional Data for entities.\n *\n * @public\n */\nexport type EntityEdgeData = {\n  /**\n   * Up to two relations that are connecting an entity.\n   */\n  relations: string[];\n  /**\n   * Whether the entity is visible or not.\n   */\n  // Not used, but has to be non-empty to draw a label at all!\n  label: 'visible';\n};\n\n/**\n * Edge between two entities.\n *\n * @public\n */\nexport type EntityEdge = DependencyGraphTypes.DependencyEdge<EntityEdgeData>;\n\n/**\n * Additional data for Entity Node\n *\n * @public\n */\nexport type EntityNodeData = {\n  /**\n   * The Entity\n   */\n  entity: Entity;\n  /**\n   * Whether the entity is focused, optional, defaults to false. Focused\n   * entities are highlighted in the graph.\n   */\n  focused?: boolean;\n  /**\n   * Optional color of the entity, defaults to 'default'.\n   */\n  color?: 'primary' | 'secondary' | 'default';\n  /**\n   * Optional click handler.\n   */\n  onClick?: MouseEventHandler<unknown>;\n\n  /**\n   * Name of the entity.\n   * @deprecated use {@link EntityNodeData#entity} instead\n   */\n  name: string;\n  /**\n   * Optional kind of the entity.\n   * @deprecated use {@link EntityNodeData#entity} instead\n   */\n  kind?: string;\n  /**\n   * Optional title of the entity.\n   * @deprecated use {@link EntityNodeData#entity} instead\n   */\n  title?: string;\n  /**\n   * Namespace of the entity.\n   * @deprecated use {@link EntityNodeData#entity} instead\n   * The Entity\n   */\n  namespace: string;\n  /**\n   * Optional spec of the entity.\n   * @deprecated use {@link EntityNodeData#entity} instead\n   */\n  spec?: JsonObject;\n};\n\n/**\n * Node representing an entity.\n *\n * @public\n */\nexport type EntityNode = DependencyGraphTypes.DependencyNode<EntityNodeData>;\n\n/**\n * Render direction of the graph.\n *\n * @public\n */\nexport enum Direction {\n  /**\n   * Top to bottom.\n   */\n  TOP_BOTTOM = 'TB',\n  /**\n   * Bottom to top.\n   */\n  BOTTOM_TOP = 'BT',\n  /**\n   * Left to right.\n   */\n  LEFT_RIGHT = 'LR',\n  /**\n   * Right to left.\n   */\n  RIGHT_LEFT = 'RL',\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Entity } from '@backstage/catalog-model';\nimport { useApi } from '@backstage/core-plugin-api';\nimport { catalogApiRef } from '@backstage/plugin-catalog-react';\nimport limiterFactory from 'p-limit';\nimport { Dispatch, useCallback, useRef, useState } from 'react';\nimport useAsyncFn from 'react-use/lib/useAsyncFn';\n\n// TODO: This is a good use case for a graphql API, once it is available in the\n// future.\n\nconst limiter = limiterFactory(10);\n\n/**\n * Ensures that a set of requested entities is loaded.\n */\nexport function useEntityStore(): {\n  entities: { [ref: string]: Entity };\n  loading: boolean;\n  error?: Error;\n  requestEntities: Dispatch<string[]>;\n} {\n  const catalogClient = useApi(catalogApiRef);\n  const state = useRef({\n    requestedEntities: new Set<string>(),\n    outstandingEntities: new Map<string, Promise<Entity | undefined>>(),\n    cachedEntities: new Map<string, Entity>(),\n  });\n  const [entities, setEntities] = useState<{\n    [ref: string]: Entity;\n  }>({});\n\n  const updateEntities = useCallback(() => {\n    const { cachedEntities, requestedEntities } = state.current;\n    const filteredEntities: { [ref: string]: Entity } = {};\n    requestedEntities.forEach(entityRef => {\n      const entity = cachedEntities.get(entityRef);\n\n      if (entity) {\n        filteredEntities[entityRef] = entity;\n      }\n    });\n    setEntities(filteredEntities);\n  }, [state, setEntities]);\n\n  const [asyncState, fetch] = useAsyncFn(async () => {\n    const { requestedEntities, outstandingEntities, cachedEntities } =\n      state.current;\n\n    await Promise.all(\n      Array.from(requestedEntities).map(entityRef =>\n        limiter(async () => {\n          if (cachedEntities.has(entityRef)) {\n            return;\n          }\n\n          if (outstandingEntities.has(entityRef)) {\n            await outstandingEntities.get(entityRef);\n            return;\n          }\n\n          const promise = catalogClient.getEntityByRef(entityRef);\n\n          outstandingEntities.set(entityRef, promise);\n\n          try {\n            const entity = await promise;\n\n            if (entity) {\n              cachedEntities.set(entityRef, entity);\n              updateEntities();\n            }\n          } finally {\n            outstandingEntities.delete(entityRef);\n          }\n        }),\n      ),\n    );\n  }, [state, updateEntities]);\n  const { loading, error } = asyncState;\n\n  const requestEntities = useCallback(\n    (entityRefs: string[]) => {\n      const n = new Set(entityRefs);\n      const { requestedEntities } = state.current;\n\n      if (\n        n.size !== requestedEntities.size ||\n        Array.from(n).some(e => !requestedEntities.has(e))\n      ) {\n        state.current.requestedEntities = n;\n        fetch();\n        updateEntities();\n      }\n    },\n    [state, fetch, updateEntities],\n  );\n\n  return {\n    entities,\n    loading,\n    error,\n    requestEntities,\n  };\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Entity } from '@backstage/catalog-model';\nimport { useEffect } from 'react';\nimport { useEntityStore } from './useEntityStore';\n\n/**\n * Discover the graph of entities connected by relations, starting from a set of\n * root entities. Filters are used to select which relations to includes.\n * Returns all discovered entities once they are loaded.\n */\nexport function useEntityRelationGraph({\n  rootEntityRefs,\n  filter: { maxDepth = Number.POSITIVE_INFINITY, relations, kinds } = {},\n}: {\n  rootEntityRefs: string[];\n  filter?: {\n    maxDepth?: number;\n    relations?: string[];\n    kinds?: string[];\n  };\n}): {\n  entities?: { [ref: string]: Entity };\n  loading: boolean;\n  error?: Error;\n} {\n  const { entities, loading, error, requestEntities } = useEntityStore();\n\n  useEffect(() => {\n    const expectedEntities = new Set([...rootEntityRefs]);\n    const processedEntityRefs = new Set<string>();\n\n    let nextDepthRefQueue = [...rootEntityRefs];\n    let depth = 0;\n\n    while (\n      nextDepthRefQueue.length > 0 &&\n      (!isFinite(maxDepth) || depth < maxDepth)\n    ) {\n      const entityRefQueue = nextDepthRefQueue;\n      nextDepthRefQueue = [];\n\n      while (entityRefQueue.length > 0) {\n        const entityRef = entityRefQueue.shift()!;\n        const entity = entities[entityRef];\n\n        processedEntityRefs.add(entityRef);\n\n        if (entity && entity.relations) {\n          for (const rel of entity.relations) {\n            if (\n              (!relations || relations.includes(rel.type)) &&\n              (!kinds ||\n                kinds.some(kind =>\n                  rel.targetRef.startsWith(\n                    `${kind.toLocaleLowerCase('en-US')}:`,\n                  ),\n                ))\n            ) {\n              if (!processedEntityRefs.has(rel.targetRef)) {\n                nextDepthRefQueue.push(rel.targetRef);\n                expectedEntities.add(rel.targetRef);\n              }\n            }\n          }\n        }\n      }\n\n      ++depth;\n    }\n\n    requestEntities([...expectedEntities]);\n  }, [entities, rootEntityRefs, maxDepth, relations, kinds, requestEntities]);\n\n  return {\n    entities,\n    loading,\n    error,\n  };\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { MouseEvent, useState } from 'react';\nimport useDebounce from 'react-use/lib/useDebounce';\nimport { RelationPairs, ALL_RELATION_PAIRS } from './relations';\nimport { EntityEdge, EntityNode } from './types';\nimport { useEntityRelationGraph } from './useEntityRelationGraph';\nimport { DEFAULT_NAMESPACE } from '@backstage/catalog-model';\n\n/**\n * Generate nodes and edges to render the entity graph.\n */\nexport function useEntityRelationNodesAndEdges({\n  rootEntityRefs,\n  maxDepth = Number.POSITIVE_INFINITY,\n  unidirectional = true,\n  mergeRelations = true,\n  kinds,\n  relations,\n  onNodeClick,\n  relationPairs = ALL_RELATION_PAIRS,\n}: {\n  rootEntityRefs: string[];\n  maxDepth?: number;\n  unidirectional?: boolean;\n  mergeRelations?: boolean;\n  kinds?: string[];\n  relations?: string[];\n  onNodeClick?: (value: EntityNode, event: MouseEvent<unknown>) => void;\n  relationPairs?: RelationPairs;\n}): {\n  loading: boolean;\n  nodes?: EntityNode[];\n  edges?: EntityEdge[];\n  error?: Error;\n} {\n  const [nodesAndEdges, setNodesAndEdges] = useState<{\n    nodes?: EntityNode[];\n    edges?: EntityEdge[];\n  }>({});\n  const { entities, loading, error } = useEntityRelationGraph({\n    rootEntityRefs,\n    filter: {\n      maxDepth,\n      kinds,\n      relations,\n    },\n  });\n\n  useDebounce(\n    () => {\n      if (!entities || Object.keys(entities).length === 0) {\n        setNodesAndEdges({});\n        return;\n      }\n\n      const nodes = Object.entries(entities).map(([entityRef, entity]) => {\n        const focused = rootEntityRefs.includes(entityRef);\n        const node: EntityNode = {\n          id: entityRef,\n          entity,\n          focused,\n          color: focused ? 'secondary' : 'primary',\n          // @deprecated\n          kind: entity.kind,\n          name: entity.metadata.name,\n          namespace: entity.metadata.namespace || DEFAULT_NAMESPACE,\n          title: entity.metadata.title,\n          spec: entity.spec,\n        };\n\n        if (onNodeClick) {\n          node.onClick = event => onNodeClick(node, event);\n        }\n\n        return node;\n      });\n\n      const edges: EntityEdge[] = [];\n      const visitedNodes = new Set<string>();\n      const nodeQueue = [...rootEntityRefs];\n\n      while (nodeQueue.length > 0) {\n        const entityRef = nodeQueue.pop()!;\n        const entity = entities[entityRef];\n        visitedNodes.add(entityRef);\n\n        if (entity) {\n          entity?.relations?.forEach(rel => {\n            // Check if the related entity should be displayed, if not, ignore\n            // the relation too\n            if (!entities[rel.targetRef]) {\n              return;\n            }\n\n            if (relations && !relations.includes(rel.type)) {\n              return;\n            }\n\n            if (\n              kinds &&\n              !kinds.some(kind =>\n                rel.targetRef.startsWith(`${kind.toLocaleLowerCase('en-US')}:`),\n              )\n            ) {\n              return;\n            }\n\n            if (!unidirectional || !visitedNodes.has(rel.targetRef)) {\n              if (mergeRelations) {\n                const pair = relationPairs.find(\n                  ([l, r]) => l === rel.type || r === rel.type,\n                ) ?? [rel.type];\n                const [left] = pair;\n\n                edges.push({\n                  from: left === rel.type ? entityRef : rel.targetRef,\n                  to: left === rel.type ? rel.targetRef : entityRef,\n                  relations: pair,\n                  label: 'visible',\n                });\n              } else {\n                edges.push({\n                  from: entityRef,\n                  to: rel.targetRef,\n                  relations: [rel.type],\n                  label: 'visible',\n                });\n              }\n            }\n\n            if (!visitedNodes.has(rel.targetRef)) {\n              nodeQueue.push(rel.targetRef);\n              visitedNodes.add(rel.targetRef);\n            }\n          });\n        }\n      }\n\n      setNodesAndEdges({ nodes, edges });\n    },\n    100,\n    [\n      entities,\n      rootEntityRefs,\n      kinds,\n      relations,\n      unidirectional,\n      mergeRelations,\n      onNodeClick,\n      relationPairs,\n    ],\n  );\n\n  return {\n    loading,\n    error,\n    ...nodesAndEdges,\n  };\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  CompoundEntityRef,\n  stringifyEntityRef,\n} from '@backstage/catalog-model';\nimport {\n  DependencyGraph,\n  DependencyGraphTypes,\n} from '@backstage/core-components';\nimport { errorApiRef, useApi } from '@backstage/core-plugin-api';\nimport { CircularProgress, makeStyles, useTheme } from '@material-ui/core';\nimport classNames from 'classnames';\nimport React, { MouseEvent, useEffect, useMemo } from 'react';\nimport { DefaultRenderLabel } from './DefaultRenderLabel';\nimport { DefaultRenderNode } from './DefaultRenderNode';\nimport { ALL_RELATION_PAIRS, RelationPairs } from './relations';\nimport { Direction, EntityEdge, EntityNode } from './types';\nimport { useEntityRelationNodesAndEdges } from './useEntityRelationNodesAndEdges';\n\nconst useStyles = makeStyles(\n  theme => ({\n    progress: {\n      position: 'absolute',\n      left: '50%',\n      top: '50%',\n      marginLeft: '-20px',\n      marginTop: '-20px',\n    },\n    container: {\n      position: 'relative',\n      width: '100%',\n      display: 'flex',\n      flexDirection: 'column',\n    },\n    graph: {\n      width: '100%',\n      flex: 1,\n      // Right now there is no good way to style edges between nodes, we have to\n      // fall back to these hacks:\n      '& path[marker-end]': {\n        transition: 'filter 0.1s ease-in-out',\n      },\n      '& path[marker-end]:hover': {\n        filter: `drop-shadow(2px 2px 4px ${theme.palette.primary.dark});`,\n      },\n      '& g[data-testid=label]': {\n        transition: 'transform 0s',\n      },\n    },\n  }),\n  { name: 'PluginCatalogGraphEntityRelationsGraph' },\n);\n\n/**\n * @public\n */\nexport type EntityRelationsGraphProps = {\n  rootEntityNames: CompoundEntityRef | CompoundEntityRef[];\n  maxDepth?: number;\n  unidirectional?: boolean;\n  mergeRelations?: boolean;\n  kinds?: string[];\n  relations?: string[];\n  direction?: Direction;\n  onNodeClick?: (value: EntityNode, event: MouseEvent<unknown>) => void;\n  relationPairs?: RelationPairs;\n  className?: string;\n  zoom?: 'enabled' | 'disabled' | 'enable-on-click';\n  renderNode?: DependencyGraphTypes.RenderNodeFunction<EntityNode>;\n  renderLabel?: DependencyGraphTypes.RenderLabelFunction<EntityEdge>;\n  curve?: 'curveStepBefore' | 'curveMonotoneX';\n};\n\n/**\n * Core building block for custom entity relations diagrams.\n *\n * @public\n */\nexport const EntityRelationsGraph = (props: EntityRelationsGraphProps) => {\n  const {\n    rootEntityNames,\n    maxDepth = 2,\n    unidirectional = true,\n    mergeRelations = true,\n    kinds,\n    relations,\n    direction = Direction.LEFT_RIGHT,\n    onNodeClick,\n    relationPairs = ALL_RELATION_PAIRS,\n    className,\n    zoom = 'enabled',\n    renderNode,\n    renderLabel,\n    curve,\n  } = props;\n\n  const theme = useTheme();\n  const classes = useStyles();\n  const rootEntityRefs = useMemo(\n    () =>\n      (Array.isArray(rootEntityNames)\n        ? rootEntityNames\n        : [rootEntityNames]\n      ).map(e => stringifyEntityRef(e)),\n    [rootEntityNames],\n  );\n  const errorApi = useApi(errorApiRef);\n  const { loading, error, nodes, edges } = useEntityRelationNodesAndEdges({\n    rootEntityRefs,\n    maxDepth,\n    unidirectional,\n    mergeRelations,\n    kinds,\n    relations,\n    onNodeClick,\n    relationPairs,\n  });\n\n  useEffect(() => {\n    if (error) {\n      errorApi.post(error);\n    }\n  }, [errorApi, error]);\n\n  return (\n    <div className={classNames(classes.container, className)}>\n      {loading && <CircularProgress className={classes.progress} />}\n      {nodes && edges && (\n        <DependencyGraph\n          nodes={nodes}\n          edges={edges}\n          renderNode={renderNode || DefaultRenderNode}\n          renderLabel={renderLabel || DefaultRenderLabel}\n          direction={direction}\n          className={classes.graph}\n          paddingX={theme.spacing(4)}\n          paddingY={theme.spacing(4)}\n          labelPosition={DependencyGraphTypes.LabelPosition.RIGHT}\n          labelOffset={theme.spacing(1)}\n          zoom={zoom}\n          curve={curve}\n        />\n      )}\n    </div>\n  );\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {\n  createExternalRouteRef,\n  createRouteRef,\n} from '@backstage/core-plugin-api';\n\n/**\n * Route pointing to the standalone catalog graph page.\n *\n * @public\n */\nexport const catalogGraphRouteRef = createRouteRef({\n  id: 'catalog-graph',\n});\n\n/**\n * Route pointing to the entity page.\n * Used to navigate from the graph to an entity.\n *\n * @public\n * @deprecated This route is no longer used and can be removed\n */\nexport const catalogEntityRouteRef = createExternalRouteRef({\n  id: 'catalog-entity',\n  params: ['namespace', 'kind', 'name'],\n  optional: true,\n});\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { createPlugin } from '@backstage/core-plugin-api';\nimport { catalogEntityRouteRef, catalogGraphRouteRef } from './routes';\n\n/**\n * Catalog Graph Plugin instance.\n * @public\n */\nexport const catalogGraphPlugin = createPlugin({\n  id: 'catalog-graph',\n  routes: {\n    catalogGraph: catalogGraphRouteRef,\n  },\n  externalRoutes: {\n    catalogEntity: catalogEntityRouteRef,\n  },\n});\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {\n  createComponentExtension,\n  createRoutableExtension,\n} from '@backstage/core-plugin-api';\nimport { catalogGraphPlugin } from './plugin';\nimport { catalogGraphRouteRef } from './routes';\n\n/**\n * A card that displays the directly related entities to the current entity.\n *\n * @public\n */\nexport const EntityCatalogGraphCard = catalogGraphPlugin.provide(\n  createComponentExtension({\n    name: 'EntityCatalogGraphCard',\n    component: {\n      lazy: () =>\n        import('./components/CatalogGraphCard').then(m => m.CatalogGraphCard),\n    },\n  }),\n);\n\n/**\n * A standalone page that can be added to your application providing a viewer\n * for your entities and their relations.\n *\n * @public\n */\nexport const CatalogGraphPage = catalogGraphPlugin.provide(\n  createRoutableExtension({\n    name: 'CatalogGraphPage',\n    component: () =>\n      import('./components/CatalogGraphPage').then(m => m.CatalogGraphPage),\n    mountPoint: catalogGraphRouteRef,\n  }),\n);\n"],"names":["useStyles","makeStyles","Direction","_a"],"mappings":"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"}